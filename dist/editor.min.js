function populateMe(e){fetch(e).then(e=>e.text()).then(e=>{var t=e.replace(/\r\n/g,"\n");document.getElementById("markdownInput").innerText="",document.getElementById("markdownInput").innerText=t}).then(e=>{convertToHtml()}).catch(e=>{console.log("An error occurred:",e)})}function showEditor(){document.getElementById("container-editor").classList.add("show"),document.getElementById("container-editor").classList.remove("hide"),document.getElementById("container-blobber").classList.add("hide")}function handleSelection(e){const t=window.getSelection().toString().trim(),n=content.textContent.trim();if(""!==t&&n.includes(t)&&!toolbar.contains(e.target)){const e=window.getSelection().getRangeAt(0),t=e.getBoundingClientRect(),n=t.top-toolbar.offsetHeight,o=Math.max(0,(t.left+t.right-toolbar.offsetWidth)/2),d=Math.min(window.innerWidth-toolbar.offsetWidth,o);toolbar.style.top=`${n}px`,toolbar.style.left=`${o}px`,toolbar.style.right=`${d}px`,toolbar.style.display="block";const a=e.toString().startsWith("**")&&e.toString().endsWith("**"),c=e.toString().startsWith("_")&&e.toString().endsWith("_");boldButton.classList.toggle("active",a),italicButton.classList.toggle("active",c)}else toolbar.style.display="none"}function toggleBold(){const e=window.getSelection(),t=e.getRangeAt(0),n=t.toString().startsWith("**")&&t.toString().endsWith("**");if(n){const e=t.toString().replace(/\*\*/g,"");t.deleteContents(),t.insertNode(document.createTextNode(e))}else{const e=`**${t.toString()}**`;t.deleteContents(),t.insertNode(document.createTextNode(e))}e.removeAllRanges(),e.addRange(t),handleSelection()}function toggleItalic(){const e=window.getSelection(),t=e.getRangeAt(0),n=t.toString().startsWith("_")&&t.toString().endsWith("_");if(n){const e=t.toString().replace(/_/g,"");t.deleteContents(),t.insertNode(document.createTextNode(e))}else{const e=`_${t.toString()}_`;t.deleteContents(),t.insertNode(document.createTextNode(e))}e.removeAllRanges(),e.addRange(t),handleSelection()}function addH1Heading(){const e=window.getSelection(),t=e.getRangeAt(0),n=t.toString(),o=`# ${n}\n`;t.deleteContents(),t.insertNode(document.createTextNode(o)),e.removeAllRanges(),e.addRange(t),handleSelection()}function addH2Heading(){const e=window.getSelection(),t=e.getRangeAt(0),n=t.toString(),o=`## ${n}\n`;t.deleteContents(),t.insertNode(document.createTextNode(o)),e.removeAllRanges(),e.addRange(t),handleSelection()}function addList(){const e=window.getSelection(),t=e.getRangeAt(0),n=t.toString(),o=`+ ${n}\n`;t.deleteContents(),t.insertNode(document.createTextNode(o)),e.removeAllRanges(),e.addRange(t),handleSelection()}function addSublist(){const e=window.getSelection(),t=e.getRangeAt(0),n=t.toString(),o=`  + ${n}\n`;t.deleteContents(),t.insertNode(document.createTextNode(o)),e.removeAllRanges(),e.addRange(t),handleSelection()}function addHR(){const e=window.getSelection(),t=e.getRangeAt(0),n=(t.toString(),"---\n");t.deleteContents(),t.insertNode(document.createTextNode(n)),e.removeAllRanges(),e.addRange(t),handleSelection()}function convertToHtml(){const e=document.getElementById("markdownInput").innerText,t=new window.markdownit,n=t.render(e);html=markdownPlus(n,"editor"),document.getElementById("htmlOutput").innerHTML=html}async function encrypt(e,t){const n=await encryptData(e,t);return document.getElementById("encryptedText").innerText=n,localStorage.setItem("tempTexte",n),n}async function encryptData(e,t){try{const n=window.crypto.getRandomValues(new Uint8Array(16)),o=window.crypto.getRandomValues(new Uint8Array(12)),d=await getPasswordKey(t),a=await deriveKey(d,n,["encrypt"]),c=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o},a,enc.encode(e)),r=new Uint8Array(c);let l=new Uint8Array(n.byteLength+o.byteLength+r.byteLength);l.set(n,0),l.set(o,n.byteLength),l.set(r,n.byteLength+o.byteLength);const i=buff_to_base64(l);return i}catch(e){return""}}function handleKeyUp(){var e=document.getElementById("editor-password").value,t=document.getElementById("markdownInput").innerText;encrypt(t,e),localStorage.setItem("tempText",t)}function togglePasswordVisibility(e,t){e.addEventListener("click",()=>{const n="password"===t.getAttribute("type")?"text":"password";t.setAttribute("type",n),e.classList.toggle("open")})}function createIDB(){let e=indexedDB.open("systemm");e.onerror=function(e){console.log("Database error: "+e.target.errorCode)},e.onupgradeneeded=function(e){let t=e.target.result,n=t.createObjectStore("records",{keyPath:"id",autoIncrement:!0});n.createIndex("id","id",{unique:!0}),n.createIndex("theindex","theindex",{unique:!0}),n.createIndex("thetext","thetext",{unique:!1})}}async function openDatabase(){return new Promise((e,t)=>{const n=indexedDB.open("systemm",1);n.onerror=function(e){t(`Failed to open database: ${e.target.errorCode}`)},n.onupgradeneeded=function(e){const t=e.target.result,n=t.createObjectStore("records",{keyPath:"id"});n.createIndex("id","id",{unique:!0}),n.createIndex("theindex","theindex",{unique:!0}),n.createIndex("thetext","thetext",{unique:!1})},n.onsuccess=function(t){const n=t.target.result;e(n)}})}async function dbit(e,t){let n=indexedDB.open("systemm");n.onerror=function(e){console.log("Database error: "+e.target.errorCode)},n.onupgradeneeded=function(e){let t=e.target.result,n=t.createObjectStore("records",{keyPath:"id",autoIncrement:!0});n.createIndex("id","id",{unique:!0}),n.createIndex("theindex","theindex",{unique:!0}),n.createIndex("thetext","thetext",{unique:!1})},n.onsuccess=function(n){let o=n.target.result,d=o.transaction(["records"],"readwrite"),a=d.objectStore("records"),c={theindex:e,thetext:t},r=a.add(c);r.onsuccess=function(e){},r.onerror=function(e){console.log("Error adding record to database: "+e.target.errorCode)},d.oncomplete=function(e){o.close()}}}async function getRecords(){const e=await openDatabase(),t=e.transaction("records","readonly"),n=t.objectStore("records"),o=n.index("id"),d=await new Promise((e,t)=>{const n=o.getAll();n.onerror=function(e){t(`Failed to get records: ${e.target.errorCode}`)},n.onsuccess=function(t){e(t.target.result)}});return d}async function displayRecords(){const e=await getRecords(),t=document.getElementById("output");t.innerHTML="",e.forEach(e=>{const n=document.createElement("details"),o=document.createElement("summary"),d=document.createElement("button");o.textContent=e.theindex,d.textContent="DELETE",d.addEventListener("click",async t=>{t.preventDefault();const n=await openDatabase(),o=n.transaction("records","readwrite"),a=o.objectStore("records");a.delete(e.id),o.oncomplete=function(){displayRecords(),d.focus()}});const a=document.createElement("div");a.textContent=e.thetext,a.classList.add("file-list-local"),d.classList.add("del-boy"),d.classList.add("background-color-two"),n.appendChild(o),n.appendChild(d),n.appendChild(a),t.appendChild(n),n.classList.add("d-f"),n.focus()})}function cloudList(){function e(e){var t=new Date(1e3*e),n=t.toISOString().slice(0,19).replace("T"," ");return n}function t(e){localStorage.removeItem(e),cloudList()}function n(e){return function(){t(e)}}function o(e){return function(t){t.preventDefault();var n=e.getAttribute("href");d(n);var o=this;o.textContent="LINK COPIED!",setTimeout(function(){o.textContent="COPY LINK"},2e3),o.focus()}}function d(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}var a=Object.keys(localStorage),c=a.filter(function(e){return e.startsWith("cloudinary")}),r=c.map(function(t){var n=t.split(","),o=n[2],d=localStorage.getItem(t);try{var a=JSON.parse(d),c=a.loc,r=parseInt(n[1]),l=e(r);return{filename:o,date:l,location:c,key:t}}catch(e){return console.log("Error parsing JSON for key:",t,e),null}});r=r.filter(function(e){return null!==e}),r.sort(function(e,t){var n=e.filename,o=t.filename;return n.localeCompare(o)});var l=document.getElementById("cloud-list");l.innerHTML="";for(var i=0;i<r.length;i++){var s=r[i],u=s.filename,m=s.date,g=s.location,p=s.key,y=document.createElement("div");y.classList.add("file-wrapper");var h=document.createElement("a");h.href=g,h.textContent=u+" - "+m;var E=document.createElement("div");E.classList.add("button-container");var f=document.createElement("button");f.textContent="DELETE LINK",f.classList.add("del-boy"),f.classList.add("background-color-two"),f.addEventListener("click",n(p));var I=document.createElement("button");I.textContent="COPY LINK",I.classList.add("del-boy"),I.classList.add("background-color-two"),I.addEventListener("click",o(h)),E.appendChild(f),E.appendChild(I),y.appendChild(h),y.appendChild(E),l.appendChild(y)}}function functionc1(){var e=document.getElementById("cloud-1-input").value;localStorage.setItem("cloud-1",e)}function functionc2(){var e=document.getElementById("cloud-2-input").value;localStorage.setItem("cloud-2",e)}function functionc3(){var e=document.getElementById("cloud-3-input").value;localStorage.setItem("cloud-3",e)}async function cloudinary(e,t,n,o,d,a){cloud_name=e,cloud_folder=t,upload_preset=n,str=o,b64=btoa(str);const c="data:text/plain;base64,"+b64,r=new FormData;r.append("file",c),r.append("upload_preset",upload_preset);const l={method:"POST",body:r,folder:cloud_folder,disallow_public_id:!0,unique_filename:!1,filename_override:!0,use_filename:!0,tags:"vu-q"+d,public_id:d,format:"text/plain"};return fetch(`https://api.cloudinary.com/v1_1/${cloud_name}/raw/upload`,l).then(e=>{if(e.status>=200&&e.status<=299)return e.json();console.log("error")}).then(e=>{e.secure_url;var t='{"loc":"'+e.secure_url+'","f":"'+a+'"}';localStorage.setItem("cloudinary,"+a+","+d,t),document.getElementById("message").innerText=e.secure_url,cloudList()})}function download_txt(){if(fn=document.getElementById("entered-file-name").value,null!==fn&&""!==fn){var e=document.getElementById("encryptedText").innerText,t=document.createElement("a");t.href="data:text/plain,"+encodeURIComponent(e),t.target="_blank",t.download=document.getElementById("entered-file-name").value,t.click();var n=document.getElementById("localme");if(n.checked)dbit(document.getElementById("entered-file-name").value,e),displayRecords();else{var o=document.getElementById("cloudme");if(o.checked){var d=[document.getElementById("cloud-1-input").value,document.getElementById("cloud-2-input").value,document.getElementById("cloud-3-input").value,document.getElementById("entered-file-name").value,Math.floor(Date.now()/1e3).toString()];cloudinary(d[0],d[1],d[2],e,d[3],d[4])}}}}document.getElementById("cloud-1-input").value=localStorage.getItem("cloud-1"),document.getElementById("cloud-2-input").value=localStorage.getItem("cloud-2"),document.getElementById("cloud-3-input").value=localStorage.getItem("cloud-3"),window.addEventListener("load",function(){const e=localStorage.getItem("tempText");e&&(markdownInput.innerText=e),convertToHtml()});const toggleButton=document.getElementById("toggle"),myTextbox=document.getElementById("markdownInput"),wrapped=document.getElementById("wrapped"),unwrapped=document.getElementById("unwrapped");toggleButton.addEventListener("click",()=>{myTextbox.classList.toggle("nowrap"),wrapped.classList.contains("hide")?(wrapped.classList.remove("hide"),unwrapped.classList.add("hide")):(wrapped.classList.add("hide"),unwrapped.classList.remove("hide"))});const reloadButton=document.getElementById("relode");reloadButton.addEventListener("click",async()=>{showEditor(),document.getElementById("markdownInput").innerText="",document.getElementById("htmlOutput").innerText=""});const sampleButton=document.getElementById("sample-button");sampleButton.addEventListener("click",async()=>{showEditor(),populateMe("sandbox.txt")});const templateButton=document.getElementById("template-button");templateButton.addEventListener("click",async()=>{showEditor(),populateMe("template.txt")});const mediaButton=document.getElementById("media-button");mediaButton.addEventListener("click",async()=>{showEditor(),populateMe("media.txt")});const blobberButton=document.getElementById("blobber-button");blobberButton.addEventListener("click",async()=>{console.log("blobber button clicked"),document.getElementById("container-editor").classList.add("hide"),document.getElementById("container-blobber").classList.remove("hide"),document.getElementById("container-blobber").classList.add("show"),document.getElementById("the-drop-area").classList.remove("hide"),document.getElementById("the-drop-area").classList.add("show")});const toolbar=document.getElementById("floating-toolbar"),boldButton=document.getElementById("bold-button"),italicButton=document.getElementById("italic-button"),h1Button=document.getElementById("h1-button"),h2Button=document.getElementById("h2-button"),listButton=document.getElementById("list-button"),sublistButton=document.getElementById("sublist-button"),hrButton=document.getElementById("hr-button"),content=document.getElementById("markdownInput");content.addEventListener("mouseup",handleSelection),document.addEventListener("keyup",handleSelection),boldButton.addEventListener("click",toggleBold),italicButton.addEventListener("click",toggleItalic),h1Button.addEventListener("click",addH1Heading),h2Button.addEventListener("click",addH2Heading),listButton.addEventListener("click",addList),sublistButton.addEventListener("click",addSublist),hrButton.addEventListener("click",addHR);const passwordInput=document.getElementById("editor-password"),textarea=document.getElementById("markdownInput");textarea.addEventListener("keyup",function(){convertToHtml(),handleKeyUp(),textarea.style.height="auto",textarea.style.height=textarea.scrollHeight+"px"}),passwordInput.addEventListener("keyup",handleKeyUp);const buff_to_base64=e=>btoa(String.fromCharCode.apply(null,e)),base64_to_buf=e=>Uint8Array.from(atob(e),e=>e.charCodeAt(null)),enc=new TextEncoder,dec=new TextDecoder,getPasswordKey=e=>window.crypto.subtle.importKey("raw",enc.encode(e),"PBKDF2",!1,["deriveKey"]),deriveKey=(e,t,n)=>window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:25e4,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,n);passwordInput.addEventListener("keyup",handleKeyUp),togglePasswordVisibility(document.getElementById("e1"),document.querySelector("#editor-password"));const copyenrypted=document.getElementById("copy-encrypted");copyenrypted.addEventListener("click",async()=>{var e=document.getElementById("encryptedText");await navigator.clipboard.writeText(e.innerHTML),copyenrypted.textContent="DATA COPIED!",setTimeout(function(){copyenrypted.textContent="COPY ENCRYPTED"},2e3),copyenrypted.focus()});const copymarkdown=document.getElementById("small-copy-button"),coppy=document.getElementById("coppy");copymarkdown.addEventListener("click",async()=>{var e=document.getElementById("markdownInput");await navigator.clipboard.writeText(e.innerText),coppy.innerHTML='<img src="./images/check.svg" /><span class="tooltip">Copied!</span>',console.log("copied!"),setTimeout(function(){console.log("revert"),coppy.innerHTML='<img src="./images/copy.svg" /><span class="tooltip">Copy</span>'},1e3),copymarkdown.focus()});const poppyButton=document.getElementById("poppy");poppyButton.addEventListener("click",()=>{navigator.clipboard.readText().then(e=>{document.getElementById("markdownInput").innerHTML=e}).catch(e=>{console.error("Failed to read clipboard contents: ",e)})}),createIDB(),displayRecords();const checkbox2=document.getElementById("cloudme");checkbox2.addEventListener("click",function(){this.checked?(document.getElementById("cloud-container").classList.remove("hide"),document.getElementById("cloud-container").classList.add("show")):(document.getElementById("cloud-container").classList.add("hide"),document.getElementById("cloud-container").classList.remove("show"))}),cloudList(),document.getElementById("cloud-1").addEventListener("keyup",functionc1),document.getElementById("cloud-2").addEventListener("keyup",functionc2),document.getElementById("cloud-3").addEventListener("keyup",functionc3);const filenameInput=document.getElementById("entered-file-name");filenameInput.addEventListener("input",function(e){const t=e.data,n=/^[a-zA-Z0-9_. -]+$/;n.test(t)||(filenameInput.value=filenameInput.value.replace(t,""))}),document.getElementById("save-encrypted-to-text-file").addEventListener("click",download_txt);