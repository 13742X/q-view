function transitionAfterPageLoad(){document.getElementById("body").classList.remove("no-transition")}function checkURL(){try{var e=window.location.href;if(e.includes("?")){var t=e.split("?")[1];t=atob(t),t=decodeURIComponent(t),t=t.replace("?a=",""),t=t.replace("&b=",","),t=t.replace("&c=",","),t=t.replace("&d=",",");const n=t.split(",");let a,l,c,r;a=n[0].trim(),l=n[1].trim(),c=n[2].trim(),r=n[3].trim();var o="?a="+a+"&b="+l+"&c="+c+"&d="+r;o=encodeURIComponent(o),o=btoa(o),e=e.replace("#",""),localStorage.setItem("link,"+a,e+"?"+o),localStorage.setItem("papName",a),localStorage.setItem("pap",l),localStorage.setItem("papIndex",c),localStorage.setItem("logo",r)}}catch(e){console.log("An error occurred:")}}function searchPairsByPrefix(e){var t="";for(let o=0;o<localStorage.length;o++){const n=localStorage.key(o);if(n.startsWith(e)){const e=localStorage.getItem(n),o=n.split(","),a=o[o.length-1];t+="<span class='tag background-color-three font-color-two' id='"+a+"'><a target='popout' href='"+e+"'>"+a+"</a></span> "}}return t}function createTheTags(){var e=document.getElementById("i7").value;if(null===e||""===e)document.getElementById("the-create-message").innerText="Enter and Create";else{url=window.location.href,document.getElementById("the-create-message").innerText="",localStorage.setItem("pap",document.getElementById("i1").value),localStorage.setItem("papIndex",document.getElementById("i2").value),localStorage.setItem("logo",document.getElementById("i6").value),localStorage.setItem("papName",document.getElementById("i7").value),document.getElementById("pname").value=document.getElementById("i7").value,document.getElementById("namer").innerText=document.getElementById("i7").value;var t=e,o=localStorage.getItem("pap"),n=localStorage.getItem("papIndex"),a=localStorage.getItem("logo"),l="?a="+t+"&b="+o+"&c="+n+"&d="+a;l=encodeURIComponent(l),l=btoa(l),url=url.replace("#",""),localStorage.setItem("link,"+t,url+"?"+l),checkURL();var c=searchPairsByPrefix("link");document.getElementById("tag-container").innerHTML=c,document.getElementById("i7").value=""}const r=document.getElementById("tag-container"),d=r.querySelectorAll(".tag");d.forEach(e=>{const t=document.createElement("span");console.log("create deletes"),t.innerHTML="&times;",t.classList.add("delete-button"),t.classList.add("background-color-five"),t.addEventListener("click",()=>{deleteTag(e.id),createDropdownList()}),e.appendChild(t)}),createDropdownList()}function deleteTag(e){const t=document.getElementById(e);t.parentNode.removeChild(t),localStorage.removeItem("link,"+e)}function createDropdownList(){document.getElementById("links-dropdown");document.getElementById("links-dropdown").innerHTML="";const e=Object.keys(localStorage),t=e.filter(e=>e.startsWith("link"));t.forEach(e=>{const t=localStorage.getItem(e),o=e.slice(5);document.getElementById("links-dropdown").innerHTML+="<div><a href='"+t+"'>"+o+"</a></div>"})}window.chrome&&chrome.runtime&&chrome.runtime.id?(console.log("crx"),display.setAttribute("href","./css/crx-style.min.css")):(console.log("www"),display.setAttribute("href","./css/www-style.min.css"));var ssheet="./css/default.min.css",ssheetshort="default.css";theme.setAttribute("href",ssheet),localStorage.getItem("papSheet")?(theme.setAttribute("href","./css/"+localStorage.getItem("papSheet")),document.getElementById("ss").value=localStorage.getItem("papSheet")):(localStorage.setItem("papSheet",ssheetshort),theme.setAttribute("href",ssheet),document.getElementById("ss").value=ssheetshort),transitionAfterPageLoad(),document.getElementById("refresher").classList.add("icon-hide"),document.getElementById("the-options").classList.add("icon-hide"),document.getElementById("the-sandbox").classList.add("icon-hide"),document.getElementById("setting-items").classList.add("hide"),checkURL();try{var linko=searchPairsByPrefix("link");document.getElementById("tag-container").innerHTML=linko}catch{}var cbutton=document.getElementById("createlink");cbutton.onclick=function(){createTheTags()};const textBox=document.getElementById("i7");textBox.addEventListener("keydown",function(e){const t=e.key,o=/^[a-zA-Z0-9\b]+$/.test(t);o||e.preventDefault()}),textBox.addEventListener("paste",function(e){e.preventDefault()}),createTheTags();var impbutton=document.getElementById("importlink");impbutton.onclick=function(){try{var e=document.getElementById("imp1").value;e=atob(e),e=decodeURIComponent(e),e=e.replace("?a=",""),e=e.replace("&b=",","),e=e.replace("&c=",","),e=e.replace("&d=",",");const o=e.split(",");let n,a,l,c;n=o[0].trim(),a=o[1].trim(),l=o[2].trim(),c=o[3].trim();var t="?a="+n+"&b="+a+"&c="+l+"&d="+c;t=encodeURIComponent(t),t=btoa(t),url=window.location.href,url=url.replace("#",""),localStorage.setItem("link,"+n,url+"?"+t),localStorage.setItem("pap",a),localStorage.setItem("papIndex",l),localStorage.setItem("logo",c),url+="?"+t,window.location.href=url}catch{console.log("Failed to decode the import...")}};var pk=url=window.location.href;if(pk.includes("?")&&!pk.includes("&")){const e=pk.split("?"),t=e[e.length-1];document.getElementById("pkey").value=t;const o=document.getElementById("copyButton");o.classList.add("show");const n=document.getElementById("pkey");var thisname=localStorage.getItem("papName");document.getElementById("pname").value=thisname,o.addEventListener("click",async()=>{try{document.getElementById("copy-message").classList.remove("hide"),document.getElementById("copy-message").classList.add("show"),await navigator.clipboard.writeText(n.value),wait(500),document.getElementById("copy-message").classList.remove("show"),document.getElementById("copy-message").classList.add("hide")}catch(e){console.error("Failed to copy text: ",e)}})}else{document.getElementById("pkey").value="";const e=document.getElementById("copyButton");e.classList.add("hide")}createDropdownList();var dropdown=document.getElementById("dropdown"),dropdownContent=document.getElementById("content");
function handleClick(){document.getElementById("savecontainer").classList.remove("hide");const e=document.getElementById("fileContents");e.innerText="Type here...",document.getElementById("fileName").value="new file.txt",document.getElementById("filelabel").classList.add("hide"),document.getElementById("file-new").classList.add("hide"),document.getElementById("button-padding").classList.add("hide")}function stripHtml(e){let t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""}function download_txt(){var e=stripHtml(document.getElementById("fileContents").innerText);if(document.getElementById("encryptme").checked)key=document.getElementById("new-pwd").value,encrypt(e,key).then(e=>{dbit(document.getElementById("fileName").value,e);var t=document.createElement("a");t.href="data:text/plain,"+e,t.target="_blank",t.download=document.getElementById("fileName").value,t.click()}).catch(e=>{});else{var t=document.createElement("a");t.href="data:text/plain,"+encodeURIComponent(e),t.target="_blank",t.download=document.getElementById("fileName").value,t.click()}var n=document.getElementById("localme");n.checked&&(dbit(document.getElementById("fileName").value,e),displayRecords());var l=document.getElementById("cloudme");if(l.checked){var o=[localStorage.getItem("cloud-1"),localStorage.getItem("cloud-2"),localStorage.getItem("cloud-3"),document.getElementById("fileName").value,Math.floor(Date.now()/1e3).toString()];cloudinary(o[0],o[1],o[2],e,o[3],o[4])}}function isBase64(e){try{return btoa(atob(e))==e}catch(e){return!1}}var button=document.getElementById("dots");button.onclick=function(){function e(){var e=document.getElementById("i1").value;localStorage.setItem("pap",e)}function t(){var e=document.getElementById("i2").value;localStorage.setItem("papIndex",e)}function n(){var e=document.getElementById("i4").value;localStorage.setItem("papAPI",e)}function n(){var e=document.getElementById("i5").value;localStorage.setItem("papEkey",e)}function l(){var e=document.getElementById("i6").value;localStorage.setItem("logo",e)}function o(){var e=document.getElementById("ss").value;localStorage.setItem("papSheet",e),"default.css"===e&&(e="./css/default.min.css"),"modern.css"===e&&(e="./css/modern.min.css"),"corporate.css"===e&&(e="./css/corporate.min.css"),"retro.css"===e&&(e="./css/retro.min.css"),console.log(e),theme.setAttribute("href",e)}function d(){var e=document.getElementById("cloud-1-input").value;localStorage.setItem("cloud-1",e)}function a(){var e=document.getElementById("cloud-2-input").value;localStorage.setItem("cloud-2",e)}function c(){var e=document.getElementById("cloud-3-input").value;localStorage.setItem("cloud-3",e)}document.getElementById("refresher").classList.remove("icon-hide"),document.getElementById("the-options").classList.remove("icon-hide"),document.getElementById("the-sandbox").classList.remove("icon-hide");var m=document.querySelector(".sidebar");m.classList.add("hide");var s=document.getElementById("setting-items");s.classList.remove("hide");var u=document.getElementById("thesettings");u.classList.toggle("hide");const i=document.getElementsByClassName("showme");for(const e of i)e.classList.add("hideme"),e.classList.remove("showme"),document.getElementById("footer").innerText="";document.getElementById("footer").innerText="",hidesplash(),deactivate(),document.getElementById("savecontainer").classList.add("hide"),document.getElementById("thesettings").classList.remove("hide"),document.getElementById("i1").value=localStorage.getItem("pap"),document.getElementById("i2").value=localStorage.getItem("papIndex"),document.getElementById("i4").value=localStorage.getItem("papAPI"),document.getElementById("i5").value=localStorage.getItem("papEkey"),document.getElementById("i6").value=localStorage.getItem("logo"),document.getElementById("ss").value=localStorage.getItem("papSheet"),document.getElementById("pname").value=localStorage.getItem("papName"),document.getElementById("cloud-1").value=localStorage.getItem("cloud-1"),document.getElementById("cloud-2").value=localStorage.getItem("cloud-2"),document.getElementById("cloud-3").value=localStorage.getItem("cloud-3"),document.getElementById("i1").addEventListener("keyup",e),document.getElementById("i2").addEventListener("keyup",t),document.getElementById("i4").addEventListener("keyup",n),document.getElementById("i5").addEventListener("keyup",n),document.getElementById("i6").addEventListener("keyup",l),document.getElementById("ss").addEventListener("keyup",o),document.getElementById("cloud-1").addEventListener("keyup",d),document.getElementById("cloud-2").addEventListener("keyup",a),document.getElementById("cloud-3").addEventListener("keyup",c)};var md="help.md",mu="help.csv",tt="SystemM Viewer",hh="Help",defaultLogo="default-logo.svg",splashscr="<div><h1>Welcome to the splash screen</h1><p>Tell your customers what you want</div>";if(splashscr="",document.getElementById("footer").innerText="",document.getElementById("splash").innerHTML=splashscr,localStorage.hasOwnProperty("papName")&&null!==localStorage.getItem("papName")){var pn=localStorage.getItem("papName");document.getElementById("namer").innerText=pn}else localStorage.setItem("papName",hh),document.getElementById("namer").innerText=hh;if(document.getElementById("cloud-1-input").value=localStorage.getItem("cloud-1"),document.getElementById("cloud-2-input").value=localStorage.getItem("cloud-2"),document.getElementById("cloud-3-input").value=localStorage.getItem("cloud-3"),""===localStorage.getItem("papIndex")&&""===localStorage.getItem("pap")&&(localStorage.clear("papIndex"),localStorage.clear("pap"),localStorage.setItem("papIndex",mu),localStorage.setItem("pap",md)),""===localStorage.getItem("papIndex")&&(localStorage.clear("papIndex"),localStorage.setItem("papIndex",mu)),localStorage.hasOwnProperty("papIndex")&&null!==localStorage.getItem("papIndex")?mu=localStorage.getItem("papIndex"):localStorage.setItem("papIndex",mu),""===localStorage.getItem("pap")&&(localStorage.clear("pap"),localStorage.setItem("papIndex",mu)),localStorage.hasOwnProperty("pap")&&null!==localStorage.getItem("pap")?md=localStorage.getItem("pap"):localStorage.setItem("pap",md),localStorage.getItem("logo")){var oldss=localStorage.getItem("logo");document.getElementById("logo").innerHTML="<image class='logo' src='"+oldss+"' />"}else localStorage.setItem("logo",defaultLogo),document.getElementById("logo").innerHTML="<image class='logo' src='"+defaultLogo+"' />";const thetitle=tt;document.getElementById("tit").innerText=thetitle;const fileInput=document.getElementById("fileInput"),fileContents=document.getElementById("fileContents");fileInput.addEventListener("change",function(){const e=fileInput.files[0],t=new FileReader;t.addEventListener("load",function(){chrome.runtime.getPackageDirectoryEntry(function(e){}),fileContents.textContent=t.result,document.getElementById("savecontainer").classList.remove("hide"),document.getElementById("filelabel").classList.add("hide"),document.getElementById("file-new").classList.add("hide"),document.getElementById("button-padding").classList.add("hide")}),t.readAsText(e)});const nbutton=document.getElementById("file-new");nbutton.addEventListener("click",handleClick);const thefileInput=document.getElementById("fileInput"),fileName=document.getElementById("fileName");thefileInput.addEventListener("change",()=>{fileName.textContent=thefileInput.files[0].name});const checkbox=document.getElementById("encryptme");checkbox.addEventListener("click",function(){this.checked?(document.getElementById("new-pwd-container").classList.remove("hide"),document.getElementById("new-pwd-container").classList.add("show")):(document.getElementById("new-pwd-container").classList.add("hide"),document.getElementById("new-pwd-container").classList.remove("show"))});const checkbox2=document.getElementById("cloudme");checkbox2.addEventListener("click",function(){this.checked?(document.getElementById("cloud-container").classList.remove("hide"),document.getElementById("cloud-container").classList.add("show")):(document.getElementById("cloud-container").classList.add("hide"),document.getElementById("cloud-container").classList.remove("show"))}),document.getElementById("downwego").addEventListener("click",download_txt);
function togglePasswordVisibility(e,t){e.addEventListener("click",()=>{const n="password"===t.getAttribute("type")?"text":"password";t.setAttribute("type",n),e.classList.toggle("open")})}function wait(e){for(var t=(new Date).getTime(),n=t;n<t+e;)n=(new Date).getTime()}function hidesplash(){try{document.getElementById("splash").classList.add("hide")}catch{}}function deactivate(){try{const e=document.getElementsByClassName("active");for(const t of e)t.classList.remove("active")}catch{}}function getMenus(e){fetch(e).then(e=>e.text()).then(e=>{csvFile=e.trim(),document.getElementById("footer").innerText="";const t=csvFile.split("\n");var n,o,i="",s="x";t.forEach(e=>{const t=e.split(",");let c,d,l;c=t[0].trim(),d=t[1].trim(),l=t[2].trim(),n="</details>",o=l.charAt(0),null==c||""===c||("c"===o&&(i+="<a id='"+c+"' class='menuitem font-color-two' href='#'>"+d+"</a>"),"o"===o&&"c"!==s&&(i+="<a id='"+c+"' class='menuitem font-color-two' href='#'>"+d+"</a>"),"o"===o&&"c"===s&&(i+=n+"<a id='"+c+"' class='menuitem font-color-two' href='#'>"+d+"</a>"),"p"===o&&"c"!==s&&(i+="<details><summary>"+d+"</summary>"),"p"===o&&"c"===s&&(i+=n+"<details><summary>"+d+"</summary>"),s=o)}),document.getElementById("i2").classList.remove("error-red"),e=i,document.getElementById("items").innerHTML="<div id='menu' class='sidebar fakecontent'>"+e+"</div>"}).then(e=>{try{let e=document.querySelectorAll(".menuitem");e.forEach(function(e){e.addEventListener("click",function(){saveem(this.id)})})}catch{console.log("event listeners not loaded as no file")}}).catch(e=>console.log("Failed to load menu"),document.getElementById("items").innerHTML="<div class='menu-not-found'>Menu file not loaded</div>",document.getElementById("i2").classList.add("error-red"))}function getMarkdown(e){fetch(e).then(e=>{if(!e.ok)throw new Error("Failed to fetch the main file. Response status: "+e.status);return e.text()}).then(e=>{isBase64(e)&&(console.log("Encrypted file"),e=atob(decrypt(e,localStorage.getItem("papEkey"))));const t=convertToHtml(e),n=document.getElementById("niv-text");n.innerHTML=t,document.getElementById("footer").innerText="",document.getElementById("i1").classList.remove("error-red");const o=t.split(/\s+/).filter(e=>""!==e),i=o.length,s=t.split(/[.!?]+/).filter(e=>""!==e),c=s.length,d=t.split(/\n\s*\n/).filter(e=>""!==e),l=(d.length,200),a=i/l,m=Math.ceil(a);document.getElementById("statistics").innerText="Words "+i+" Sentences "+c+" Reading time "+m+" minutes"}).catch(e=>{console.log("Error occurred while fetching or processing the markdown file:",e),document.getElementById("niv-text").innerHTML="<div class='file-not-found'>Markdown file not loaded</div>",document.getElementById("settings").classList.remove("hide"),document.getElementById("i1").classList.add("error-red")});let t=document.querySelectorAll(".menuitem");t.forEach(function(e){e.addEventListener("click",function(){saveem(this.id)})})}function convertToHtml(e){const t=e,n=new window.markdownit,o=n.render(t),i=/\{\{([^}{]+)}}\s*\[\[([^\ยง]+?)\]\]/g,s=/\{\{\{([^}{]+)}}}\s*\[\[([^\ยง]+?)\]\]/g,c=/<img\b(.*?)>/g,d=o.replace(i,'<div id="t$1" class="hideme">$2</div>').replace(s,'<div id="t$1" class="showme">$2</div>').replace(c,'<img $1 class="responsive-image">');return d}async function saveem(e){hidesplash(),document.getElementById("thesettings").classList.add("hide");const t=document.getElementsByClassName("showme");for(const e of t)e.classList.add("hideme"),e.classList.remove("showme");deactivate();var n=document.getElementById(e);try{n.className="active font-color-two"}catch{}n=document.getElementById("t"+e);try{n.className="showme";var o=new Date;localStorage.setItem(e,o)}catch{}}togglePasswordVisibility(document.getElementById("e1"),document.querySelector("#i5")),togglePasswordVisibility(document.getElementById("e2"),document.querySelector("#new-pwd")),console.log(mu),getMenus(localStorage.getItem("papIndex")),getMarkdown(localStorage.getItem("pap"));var button=document.getElementById("burgerking");button.onclick=function(){var e=document.querySelector(".item2");e.classList.toggle("hide");var t=document.getElementById("thebody");t.classList.toggle("col2")};var reloadbutton=document.getElementById("reload");reloadbutton.onclick=function(){localStorage.setItem("papName","");const e=window.location.origin+window.location.pathname;window.location.href=e};const mq=window.matchMedia("(min-width: 700px)");if(mq.matches)console.log("desktop");else{var div=document.querySelector(".item2");div.classList.toggle("hide");var element=document.getElementById("thebody");element.classList.toggle("col2"),console.log("mobile")}document.addEventListener("DOMContentLoaded",function(e){document.querySelectorAll("img").forEach(function(e){e.onerror=function(){this.style.display="none"}})});var helpbutton=document.getElementById("help");helpbutton.onclick=function(){var e="help.md",t="help.csv";document.getElementById("namer").innerText="HELP",document.getElementById("footer").innerText="",document.getElementById("thesettings").classList.add("hide"),document.getElementById("refresher").classList.remove("icon-hide"),document.getElementById("the-options").classList.remove("icon-hide"),document.getElementById("the-sandbox").classList.remove("icon-hide"),document.getElementById("setting-items").classList.add("hide"),getMarkdown(e),getMenus(t),document.getElementById("splash").innerHTML="";try{document.getElementById("splash").classList.remove("hide")}catch{console.log("No splash exists")}},document.addEventListener("animationstart",function(e){"fade-in"===e.animationName&&e.target.classList.add("did-fade-in")}),document.addEventListener("animationend",function(e){"fade-out"===e.animationName&&e.target.classList.remove("did-fade-in")}),document.onreadystatechange=function(){"complete"==document.readyState&&setTimeout(function(){document.getElementById("loader").style.display="none"},100)};
function cloudList(){function e(e){var t=new Date(1e3*e),n=t.toISOString().slice(0,19).replace("T"," ");return n}function t(e){localStorage.removeItem(e),cloudList()}function n(e){return function(){t(e)}}function a(e){return function(t){t.preventDefault();var n=e.getAttribute("href");o(n);var a=this;a.textContent="LINK COPIED!",setTimeout(function(){a.textContent="COPY LINK"},2e3),a.focus()}}function o(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}var r=Object.keys(localStorage),c=r.filter(function(e){return e.startsWith("cloudinary")}),l=c.map(function(t){var n=t.split(","),a=n[2],o=localStorage.getItem(t);try{var r=JSON.parse(o),c=r.loc,l=parseInt(n[1]),d=e(l);return{filename:a,date:d,location:c,key:t}}catch(e){return console.log("Error parsing JSON for key:",t,e),null}});l=l.filter(function(e){return null!==e}),l.sort(function(e,t){var n=e.filename,a=t.filename;return n.localeCompare(a)});var d=document.getElementById("cloud-list");d.innerHTML="";for(var i=0;i<l.length;i++){var u=l[i],s=u.filename,m=u.date,f=u.location,p=u.key,v=document.createElement("div");v.classList.add("file-wrapper");var C=document.createElement("a");C.href=f,C.textContent=s+" - "+m;var L=document.createElement("div");L.classList.add("button-container");var E=document.createElement("button");E.textContent="DELETE LINK",E.classList.add("del-boy"),E.classList.add("background-color-two"),E.addEventListener("click",n(p));var h=document.createElement("button");h.textContent="COPY LINK",h.classList.add("del-boy"),h.classList.add("background-color-two"),h.addEventListener("click",a(C)),L.appendChild(E),L.appendChild(h),v.appendChild(C),v.appendChild(L),d.appendChild(v)}}cloudList();
(function(n,r){var e=function(n){n=n.replace(/\&/g,"&amp;");var r,e="'#|<>`*-~_=:\"![]()nt",t=e.length;for(r=0;r<t;r++)n=n.replace(RegExp("\\"+e[r],"g"),function(n){return"&#"+n.charCodeAt(0)+";"});return n},t=[{p:/\r\n/g,r:"\n"},{p:/\n\s*```\n([^]*?)\n\s*```\s*\n/g,r:function(n,r){return"<pre>"+e(r)+"</pre>"}},{p:/`(.*?)`/g,r:function(n,r){return"<code>"+e(r)+"</code>"}},{p:/\n\s*(#+)(.*?)/g,r:function(n,r,e){return n=r.length,"<h"+n+">"+e.trim()+"</h"+n+">"}},{p:/\n\s*(.*?)\n={3,}\n/g,r:"\n<h2>$1</h2>\n"},{p:/\n\s*(.*?)\n-{3,}\n/g,r:"\n<h1>$1</h1>\n"},{p:/___(.*?)___/g,r:"<u>$1</u>"},{p:/(\*\*|__)(.*?)\1/g,r:"<strong>$2</strong>"},{p:/~~(.*?)~~/g,r:"<del>$1</del>"},{p:/\!\[([^\[]+?)\]\s*\(([^\)]+?)\)/g,r:'<img src="$2" alt="$1" class="responsive-image">'},{p:/\{\{([^}{]+)}}\s*\[\[([^\ยง]+?)\]\]/g,r:'<div id="t$1" class="hideme">$2</div>'},{p:/\{\{\{([^}{]+)}}}\s*\[\[([^\ยง]+?)\]\]/g,r:'<div id="t$1" class="showme">$2</div>'},{p:/:"(.*?)":/g,r:"<q>$1</q>"},{p:/\[([^\[]+?)\]\s*\(([^\)]+?)\)/g,r:'<a href="$2" target="_blank">$1</a>'},{p:/\n\s*(\*|\-)\s*([^\n]*)/g,r:"\n<ul><li>$2</li></ul>"},{p:/\n\s*\d+\.\s*([^\n]*)/g,r:"\n<ol><li>$1</li></ol>"},{p:/\n\s*(\>|&gt;)\s*([^\n]*)/g,r:"\n<blockquote>$2</blockquote>"},{p:/<\/(ul|ol|blockquote)>\s*<\1>/g,r:" "},{p:/\n\s*\_{3,}\s*\n/g,r:"\n<hr>"},{p:/\n{3,}/g,r:"\n\n"},{p:/\n([^\n]+)\n/g,r:function(n,r){return r=r.trim(),/^\<\/?(ul|ol|bl|h\d|p).*/.test(r.slice(0,9))?r:"<p>"+r+"</p>"}},{p:/>\s+</g,r:"><"}],p=t.length;n[r]={addRule:function(n,r){t.push({p:RegExp(n,"g"),r:r})},render:function(n){if(n=n||""){n="\n"+n.trim()+"\n";for(var r=0;r<p;r++)n=n.replace(t[r].p,t[r].r)}return n}}})(self,"Systemm");
function createIDB(){let e=indexedDB.open("systemm");e.onerror=function(e){console.log("Database error: "+e.target.errorCode)},e.onupgradeneeded=function(e){let t=e.target.result,n=t.createObjectStore("records",{keyPath:"id",autoIncrement:!0});n.createIndex("id","id",{unique:!0}),n.createIndex("theindex","theindex",{unique:!0}),n.createIndex("thetext","thetext",{unique:!1})}}async function openDatabase(){return new Promise((e,t)=>{const n=indexedDB.open("systemm",1);n.onerror=function(e){t(`Failed to open database: ${e.target.errorCode}`)},n.onupgradeneeded=function(e){const t=e.target.result,n=t.createObjectStore("records",{keyPath:"id"});n.createIndex("id","id",{unique:!0}),n.createIndex("theindex","theindex",{unique:!0}),n.createIndex("thetext","thetext",{unique:!1})},n.onsuccess=function(t){const n=t.target.result;e(n)}})}async function dbit(e,t){let n=indexedDB.open("systemm");n.onerror=function(e){console.log("Database error: "+e.target.errorCode)},n.onupgradeneeded=function(e){let t=e.target.result,n=t.createObjectStore("records",{keyPath:"id",autoIncrement:!0});n.createIndex("id","id",{unique:!0}),n.createIndex("theindex","theindex",{unique:!0}),n.createIndex("thetext","thetext",{unique:!1})},n.onsuccess=function(n){let o=n.target.result,r=o.transaction(["records"],"readwrite"),d=r.objectStore("records"),c={theindex:e,thetext:t},a=d.add(c);a.onsuccess=function(e){console.log("Record added to database.")},a.onerror=function(e){console.log("Error adding record to database: "+e.target.errorCode)},r.oncomplete=function(e){o.close()}}}async function getRecords(){const e=await openDatabase(),t=e.transaction("records","readonly"),n=t.objectStore("records"),o=n.index("id"),r=await new Promise((e,t)=>{const n=o.getAll();n.onerror=function(e){t(`Failed to get records: ${e.target.errorCode}`)},n.onsuccess=function(t){e(t.target.result)}});return r}async function displayRecords(){const e=await getRecords(),t=document.getElementById("output");t.innerHTML="",e.forEach(e=>{const n=document.createElement("details"),o=document.createElement("summary"),r=document.createElement("button");o.textContent=e.theindex,r.textContent="DELETE",r.addEventListener("click",async t=>{t.preventDefault();const n=await openDatabase(),o=n.transaction("records","readwrite"),d=o.objectStore("records");d.delete(e.id),o.oncomplete=function(){displayRecords(),r.focus()}});const d=document.createElement("div");d.textContent=e.thetext,d.classList.add("file-list-local"),r.classList.add("del-boy"),r.classList.add("background-color-two"),n.appendChild(o),n.appendChild(r),n.appendChild(d),t.appendChild(n),n.classList.add("d-f"),n.focus()})}createIDB(),displayRecords();
async function encrypt(e,t){const n=await encryptData(e,t);await decryptData(n,t);return n}async function decrypt(e,t){const n=await decryptData(e,t),r=Systemm.render(n);return document.getElementById("niv-text").innerHTML=r,r||(document.getElementById("niv-text").innerHTML="File could not be decrypted. Is the private key / password correct?"),r}async function encryptData(e,t){try{const n=window.crypto.getRandomValues(new Uint8Array(16)),r=window.crypto.getRandomValues(new Uint8Array(12)),a=await getPasswordKey(t),c=await deriveKey(a,n,["encrypt"]),o=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r},c,enc.encode(e)),y=new Uint8Array(o);let i=new Uint8Array(n.byteLength+r.byteLength+y.byteLength);i.set(n,0),i.set(r,n.byteLength),i.set(y,n.byteLength+r.byteLength);const d=buff_to_base64(i);return d}catch(e){return""}}async function decryptData(e,t){try{const n=base64_to_buf(e),r=n.slice(0,16),a=n.slice(16,28),c=n.slice(28),o=await getPasswordKey(t),y=await deriveKey(o,r,["decrypt"]),i=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a},y,c);return dec.decode(i)}catch(e){return""}}const buff_to_base64=e=>btoa(String.fromCharCode.apply(null,e)),base64_to_buf=e=>Uint8Array.from(atob(e),e=>e.charCodeAt(null)),enc=new TextEncoder,dec=new TextDecoder,getPasswordKey=e=>window.crypto.subtle.importKey("raw",enc.encode(e),"PBKDF2",!1,["deriveKey"]),deriveKey=(e,t,n)=>window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:25e4,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,n);
async function highlightSearchTerms(e){for(var t=document.getElementById("content"),n=getTextNodes(t),d=0;d<n.length;d++){for(var i=n[d],o=i.nodeValue,s=o,l=0;l<e.length;l++){var a=e[l],c=new RegExp(a,"gi");s=s.replace(c,function(e){return'<span class="highlighted background-color-four">'+e+"</span>"})}if(o!==s){var r=document.createElement("span");r.innerHTML=s,i.parentNode.replaceChild(r,i)}}}function getTextNodes(e){function t(e){if(e.nodeType===Node.TEXT_NODE)n.push(e);else if(e.nodeType===Node.ELEMENT_NODE)for(var d=0;d<e.childNodes.length;d++)t(e.childNodes[d])}var n=[];return t(e),n}function triggerEvent(e,t){const n=new Event(t,{bubbles:!0,cancelable:!0});e.dispatchEvent(n)}const resizable=document.querySelector("#thetext");let initialX,initialWidth,isDragging=!1;resizable.addEventListener("mousedown",function(e){const{clientX:t,target:n}=e,{left:d,right:i}=n.getBoundingClientRect();t>=i-15&&t<=i?(initialX=t,initialWidth=parseInt(document.defaultView.getComputedStyle(resizable).width,10),isDragging=!0):t>=d&&t<=d+15&&(initialX=t,initialWidth=parseInt(document.defaultView.getComputedStyle(resizable).width,10),isDragging=!0)}),resizable.addEventListener("mousemove",function(e){if(isDragging){const t=e.clientX-initialX,{left:n,right:d}=resizable.getBoundingClientRect();e.clientX<initialX&&n+t>=0&&(resizable.style.left=`${n+t}px`),resizable.style.width=`${initialWidth+t}px`}}),resizable.addEventListener("mouseup",function(e){isDragging=!1});var textboxer=document.getElementById("searchTerm");textboxer.addEventListener("focus",function(){textboxer.value=""});var searchInput=document.getElementById("searchTerm");searchInput.addEventListener("focusout",function(){for(var e=searchInput.value,t=e.trim().split(" "),n=document.getElementsByClassName("highlighted");n.length>0;){var d=n[0].parentNode;d.replaceChild(document.createTextNode(n[0].textContent),n[0])}highlightSearchTerms(t)});const dropdownCss=document.getElementById("dropdown-css"),itemsCss=dropdownCss.getElementsByClassName("item-css"),textareaCss=document.getElementById("ss");textareaCss.addEventListener("click",()=>{dropdownCss.style.display="block"}),textareaCss.addEventListener("blur",()=>{setTimeout(()=>{dropdownCss.style.display="none"},200)}),Array.from(itemsCss).forEach(e=>{e.addEventListener("click",()=>{textareaCss.value=e.textContent,textareaCss.focus(),triggerEvent(textareaCss,"keyup"),dropdownCss.style.display="none"})}),window.addEventListener("DOMContentLoaded",function(){for(var e=document.getElementsByClassName("linkd"),t=0;t<e.length;t++)e[t].addEventListener("click",function(t){t.preventDefault();var n=this.getAttribute("href"),d=document.querySelector(n);if(d){var i=document.getElementById("thetext"),o=d.offsetTop-100;i.scrollTo({top:o,behavior:"smooth"});for(var s=0;s<e.length;s++)e[s].classList.remove("active");this.classList.add("active")}})});const filenameInput=document.getElementById("fileName");filenameInput.addEventListener("input",function(e){const t=e.data,n=/^[a-zA-Z0-9_. -]+$/;n.test(t)||(filenameInput.value=filenameInput.value.replace(t,""))});const settingsReload=document.getElementById("editor-reload");settingsReload.addEventListener("click",function(){document.getElementById("fileContents").innerText="",document.getElementById("fileName").value="",document.getElementById("filelabel").classList.remove("hide"),document.getElementById("file-new").classList.remove("hide"),document.getElementById("button-padding").classList.remove("hide"),document.getElementById("savecontainer").classList.add("hide"),document.getElementById("new-pwd-container").classList.add("hide"),document.getElementById("cloud-container").classList.add("hide"),document.getElementById("cloud-1-input").value="",document.getElementById("cloud-2-input").value="",document.getElementById("cloud-3-input").value="",document.getElementById("new-pwd").value="",document.getElementById("cloudme").checked=!1,document.getElementById("localme").checked=!1,document.getElementById("encryptme").checked=!1});const stylesheet=document.getElementById("stylesheet"),darkModeToggle=document.getElementById("darkModeToggle");if(localStorage.getItem("dm")){const e=localStorage.getItem("dm");darkModeToggle.checked="on"===e,stylesheet.disabled="on"!==e}else localStorage.setItem("dm","off");darkModeToggle.addEventListener("change",function(){stylesheet.disabled=!this.checked,localStorage.setItem("dm",this.checked?"on":"off")});
window.addEventListener("offline",t=>{const e=document.getElementById("internet-status");e.textContent="Offline"}),window.addEventListener("online",t=>{const e=document.getElementById("internet-status");e.textContent=""});
async function cloudinary(e,o,l,t,n,a){cloud_name=e,cloud_folder=o,upload_preset=l,console.log("Cloudinary"),str=t,b64=btoa(str);const r="data:text/plain;base64,"+b64,u=new FormData;u.append("file",r),u.append("upload_preset",upload_preset);const c={method:"POST",body:u,folder:cloud_folder,disallow_public_id:!0,unique_filename:!1,filename_override:!0,use_filename:!0,tags:"vu-q"+n,public_id:n,format:"text/plain"};return fetch(`https://api.cloudinary.com/v1_1/${cloud_name}/raw/upload`,c).then(e=>{if(e.status>=200&&e.status<=299)return e.json();console.log("error")}).then(e=>{e.secure_url;var o='{"loc":"'+e.secure_url+'","f":"'+a+'"}';console.log(o),localStorage.setItem("cloudinary,"+a+","+n,o),document.getElementById("new-cloud-link").innerText=e.secure_url,cloudList()}).catch(e=>{console.log("not clouded")})}